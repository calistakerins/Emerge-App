@page "/news"
@inherits LayoutComponentBase
@using emerge.Data
@using emerge.Controller

@if (feedView)
{
    //Newsfeed
    <MudAppBar Class="pb-2 pt-2" Fixed="false" Elevation="0">
        <MudText Typo="Typo.h5">Active Alerts</MudText>
    </MudAppBar>

    <NavBar />
    <MudMainContent>
        <MudContainer MaxWidth="MaxWidth.Medium">
            @foreach (var alertInfo in feedController.getAlertList()) //loop through alert list
            {

                <MudCard Class="mt-8 pt-4 rounded-xl" Outlined="true"
                         @onclick="() => OnClick(alertInfo)">
                    <MudCardMedia Image=@alertInfo.ImageUrl Height="300" />
                    <MudContainer Class="pa-4">
                        <MudCardHeader>
                            <CardHeaderContent>
                                @if (alertInfo.Title != null)
                                {
                                    <MudText Typo="Typo.h4" Style="font-weight:bold">@alertInfo.Title</MudText>
                                }
                                else
                                {
                                    <MudText Typo="Typo.h4" Style="font-weight:bold">No Title</MudText>
                                }

                                @if (alertInfo.Priority != null)
                                {
                                    <MudText Typo="Typo.h6">Priority: @alertInfo.Priority</MudText>
                                }
                                else
                                {
                                    <MudText Typo="Typo.h6">Priority: 1</MudText>//defaults to 1
                                }

                                @if (alertInfo.Affected != null)
                                {
                                    <MudText Typo="Typo.h6">Affected Area: @alertInfo.Affected</MudText>
                                }
                                else
                                {
                                    <MudText Typo="Typo.h6">No Areas Affected</MudText>
                                }

                                @if (alertInfo.Author != null)
                                {
                                    <MudText Typo="Typo.h6" Class="mt-4">@alertInfo.Author</MudText>
                                }
                                else
                                {
                                    <MudText Typo="Typo.h6">No Author</MudText>
                                }

                                @if (alertInfo.Description != null)
                                {
                                    <MudText Typo="Typo.body1">
                                        @alertInfo.Description
                                    </MudText>
                                }
                                else
                                {
                                    <MudText Typo="Typo.body1">No Description</MudText>
                                }


                            </CardHeaderContent>
                            <CardHeaderActions>
                                @if (alertInfo.Time != null)
                                {
                                    <MudText Typo="Typo.subtitle2" Class="ms-4">
                                        @alertInfo.Time.ToString("MM/dd/yyyy")
                                    </MudText>
                                    <MudText Typo="Typo.subtitle2" Class="ms-4">
                                        @alertInfo.Time.ToString("HH:mm")
                                    </MudText>
                                }

                            </CardHeaderActions>
                        </MudCardHeader>
                    </MudContainer>

                    <MudContainer Class=" pa-4 rounded-b-xl" Style="@($"color:{Colors.Shades.Black}; background:{Colors.Grey.Lighten3}; height: 15%; width: 100%")">
                        @if (alertInfo.Updates != null)
                        {
                            @foreach (var update in alertInfo.Updates) //loop through updates
                            {
                                <MudCardHeader>
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.h6">UPDATE</MudText>
                                        <MudText Typo="Typo.subtitle1">@update.UpdateDescription</MudText>
                                    </CardHeaderContent>
                                    <CardHeaderActions>
                                        <MudText Typo="Typo.subtitle2" Class="ms-4">
                                            @update.UpdateTime.ToString("MM/dd/yyyy")
                                        </MudText>
                                        <MudText Typo="Typo.subtitle2" Class="ms-4">
                                            @update.UpdateTime.ToString("HH:mm")
                                        </MudText>
                                    </CardHeaderActions>
                                </MudCardHeader>
                            }
                        }

                    </MudContainer>
                </MudCard>
            }
        </MudContainer>
    </MudMainContent>
}
else
{
    //View Alert
    <MudAppBar Class="pb-2 pt-2" Fixed="false" Elevation="0">
        <MudIconButton Icon="@Icons.Filled.ArrowBack" @onclick="returnToFeed" Color="Color.Inherit" Edge="Edge.Start" />
    </MudAppBar>
    <NavBar />

    <MudContainer Class="mt-8">
        <MudCard Class="ma-8 rounded-xl" Outlined="true">
            <MudCardMedia Image=@currentAlert.ImageUrl Height="300" />
            <MudContainer Class="pa-4 ml-4 mr-4">
                @if (currentAlert.Title != null)
                {
                    <MudText Typo="Typo.h3" Style="font-weight:bold">@currentAlert.Title</MudText>
                }
                @if (currentAlert.Priority != null)
                {
                    <MudText Typo="Typo.h5" Style="font-weight:bold">@currentAlert.Priority</MudText>
                }
                @if (currentAlert.Author != null)
                {
                    <MudText Typo="Typo.body1" Style="font-weight:bold">@currentAlert.Author</MudText>
                }
                @if (currentAlert.Time != null)
                {
                    <MudText Typo="Typo.body1">@currentAlert.Time.ToString("MM/dd/yyyy HH:mm")</MudText>
                }
                @if (currentAlert.Description != null)
                {
                    <MudText Typo="Typo.body1">@currentAlert.Description</MudText>
                }

            </MudContainer>
        </MudCard>
        <MudText Class="ma-8" Typo="Typo.h4"><b>Updates</b></MudText>

        @if (currentAlert.Updates != null)
        {
            @foreach (var update in currentAlert.Updates) //loop through updates
            {
                <MudContainer Class=" pa-4 my-4 rounded-xl" Style="@($"color:{Colors.Shades.Black}; background:{Colors.Grey.Lighten3}; height: 15%; width: 90%")">

                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudText Typo="Typo.h6">UPDATE</MudText>
                            <MudText Typo="Typo.subtitle1">@update.UpdateDescription</MudText>
                        </CardHeaderContent>
                        <CardHeaderActions>
                            <MudText Typo="Typo.subtitle2" Class="ms-4">
                                @update.UpdateTime.ToString("MM/dd/yyyy")
                            </MudText>
                            <MudText Typo="Typo.subtitle2" Class="ms-4">
                                @update.UpdateTime.ToString("HH:mm")
                            </MudText>
                        </CardHeaderActions>
                    </MudCardHeader>
                </MudContainer>
            }
        }

    </MudContainer>

}


@code {

    public static NewsAlert currentAlert;
    private MudTheme Theme = new MudTheme();
    private NewsFeedController feedController = new NewsFeedController();
    private bool feedView = true;

    private void OnClick(NewsAlert alertInfo)
    {
        feedView = false;
        currentAlert = alertInfo;
        StateHasChanged();
    }

    private void returnToFeed()
    {
        feedView = true;
        StateHasChanged();
    }


}
