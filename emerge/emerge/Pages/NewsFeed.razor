@page "/news"
@inherits LayoutComponentBase
@using emerge.Data
@using emerge.Controller

@if (feedView)
{
    //Newsfeed

    <MudContainer Class="mt-16">
        <MudText Typo="Typo.h2" Class="pa-4" Color="Color.Primary" Align="Align.Center" Style="font-weight:bolder">Active Alerts</MudText>
        <MudDivider DividerType="DividerType.Middle" Class="my-20" />
        @foreach (var alertInfo in feedController.getFirstNAlerts(@alertDisplayNum)) //loop through alert list
        {
            <MudCard Class="ma-8 rounded-xl" Outlined="true"
                     @onclick="() => OnClick(alertInfo)" Elevation="20">
                <MudCardMedia Image=@alertInfo.ImageUrl Height="300" />
                <MudContainer Class="pa-4">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudText Typo="Typo.h4" Style="font-weight:bold">@alertInfo.Title</MudText>
                            <MudText Typo="Typo.h6">Priority: 5</MudText>
                            <MudText Typo="Typo.h6" Class="mt-4">@alertInfo.Author</MudText>
                            <MudText Typo="Typo.body1">
                                description...
                            </MudText>
                        </CardHeaderContent>
                        <CardHeaderActions>
                            <MudText Typo="Typo.subtitle2" Class="ms-4">
                                @alertInfo.Time.ToString("MM/dd/yyyy")
                            </MudText>
                            <MudText Typo="Typo.subtitle2" Class="ms-4">
                                @alertInfo.Time.ToString("HH:mm")
                            </MudText>
                        </CardHeaderActions>
                    </MudCardHeader>
                </MudContainer>


            </MudCard>
        }
        
        

        <MudCarousel Class="mud-width-full" Style="height:200px;" ShowArrows="@arrows" ShowBullets="@bullets" EnableSwipeGesture="@enableSwipeGesture" AutoCycle="@autocycle" TData="object">
            @foreach (var alertInfo in feedController.getRemainingAlerts(@alertDisplayNum))
            //Carousel
            {
                <MudCarouselItem Transition="transition" Color="@Color.Primary">
                    <div class="d-flex" style="height:100%">
                        <MudCard Class="ma-8 rounded-xl" Outlined="true"
                                 @onclick="() => OnClick(alertInfo)" Elevation="20">
                            <MudCardMedia Image=@alertInfo.ImageUrl Height="300" />
                            <MudContainer Class="pa-4">
                                <MudCardHeader>
                                    <CardHeaderContent>
                                        <MudText Typo="Typo.h4" Style="font-weight:bold">@alertInfo.Title</MudText>
                                        <MudText Typo="Typo.h6">Priority: 5</MudText>
                                        <MudText Typo="Typo.h6" Class="mt-4">@alertInfo.Author</MudText>
                                        <MudText Typo="Typo.body1">
                                            description...
                                        </MudText>
                                    </CardHeaderContent>
                                    <CardHeaderActions>
                                        <MudText Typo="Typo.subtitle2" Class="ms-4">
                                            @alertInfo.Time.ToString("MM/dd/yyyy")
                                        </MudText>
                                        <MudText Typo="Typo.subtitle2" Class="ms-4">
                                            @alertInfo.Time.ToString("HH:mm")
                                        </MudText>
                                    </CardHeaderActions>
                                </MudCardHeader>
                            </MudContainer>


                        </MudCard>
                    </div>
                </MudCarouselItem>
            }
        </MudCarousel>

        <MudSwitch @bind-Checked="@arrows" Color="Color.Primary">Show Arrows</MudSwitch>
        <MudSwitch @bind-Checked="@bullets" Color="Color.Primary">Show Bullets</MudSwitch>
        <MudSwitch @bind-Checked="@enableSwipeGesture" Color="Color.Primary">Enable Swap Gesture</MudSwitch>
        <MudSwitch @bind-Checked="@autocycle" Color="Color.Primary">Auto Cycle (Default: 5 secs)</MudSwitch>
    </MudContainer>
        }
        else
        {
        //View Alert
        <MudContainer Class="mt-16">
            <MudButton Variant="Variant.Outlined" @onclick="returnToFeed">Back</MudButton>
            <MudCard Class="ma-8 rounded-xl" Outlined="true"  Elevation="20">
                <MudCardMedia Image=@currentAlert.ImageUrl Height="300" />
                <MudContainer Class="pa-4 ml-4 mr-4">
                    <MudText Typo="Typo.h3" Class="mt-5"><b>@currentAlert.Title</b></MudText>
                    <MudText Typo="Typo.h5">PRIORITY: 5</MudText>
                    <MudText Typo="Typo.body1">@currentAlert.Author</MudText>
                    <MudText Typo="Typo.body1">@currentAlert.Time.ToString("MM/dd/yyyy HH:mm")</MudText>
                    <MudText Typo="Typo.subtitle1">ncidunt turpis. In laoreet turpis leo, ut laoreet leo blandit feugiat. </MudText>
                </MudContainer>
            </MudCard>
            <MudText Class="ma-8" Typo="Typo.h4"><b>Updates</b></MudText>
            @foreach (var u in currentAlert.Updates) //loop through updates
            {
                <MudPaper Class="pa-6 ma-8  rounded-xl"  Elevation="12">
                    <MudText Typo="Typo.subtitle2">
                        @currentAlert.Time.ToString("MM/dd/yyyy")
                    </MudText>
                    <MudText Typo="Typo.subtitle2">
                        @currentAlert.Time.ToString("HH:mm")
                    </MudText>
                    <MudText Typo="Typo.subtitle1">@u.Description</MudText>
                </MudPaper>
            }
        </MudContainer>
        }


        @code {
            //first three alerts in a scroll view
            private int alertDisplayNum = 3;

            //settings for carousel
            private bool arrows = true;
            private bool bullets = true;
            private bool enableSwipeGesture = true;
            private bool autocycle = true;
            private Transition transition = Transition.Slide;

            public static AlertInfo currentAlert;
            private MudTheme Theme = new MudTheme();
            private NewsFeedController feedController = new NewsFeedController();
            private bool feedView = true;
            private void OnClick(AlertInfo alertInfo)
            {
                feedView = false;
                currentAlert = alertInfo;
                StateHasChanged();
            }

            private void returnToFeed()
            {
                feedView = true;
                StateHasChanged();
            }


        }
