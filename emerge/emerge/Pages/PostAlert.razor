@page "/postalert"
@using emerge.Data
@using System.ComponentModel.DataAnnotations
@using System.Text
@using System.Net.Mime

@*<DataAnnotationsValidator />*@
<MudText Typo="Typo.h3" Class="mt-5"><b>Post Alert</b></MudText>
<MudCard>
    <MudCardContent>
        <MudTextField Label="Title"
                      @bind-Value="AlertTitle" Variant="Variant.Filled"  Class="pt-4 pb-4" />
        <MudNumericField Label="Priority"
                         @bind-Value="AlertPriority" Variant="Variant.Filled" Min="0" Max="5" Class="pt-4 pb-4" />
        <MudTextField T="string" Label="AlertDescription" @bind-Value="AlertDescription" Variant="Variant.Filled" Lines="5" Class="pt-4 pb-4" />
    </MudCardContent>
    <MudCardActions>
        <MudButton @onclick="@AddNewsAlert" ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Post Alert</MudButton>
    </MudCardActions>
</MudCard>
<MudText Typo="Typo.h3" Class="mt-5"><b>@success</b></MudText>
@code {

    public DateTime AlertTime = new System.DateTime(2019, 05, 09, 09, 37, 07);
    public string AlertTitle { get; set; }
    public string AlertAuthor = "Dummy";
    public int AlertPriority { get; set; }
    public string AlertDescription { get; set; }
    public UpdateInfo[] updateInfo = new UpdateInfo[0];
    public bool success = false;


    private async Task AddNewsAlert()
    {

        HttpClient client = new HttpClient { BaseAddress = new Uri("https://emergeproj.azurewebsites.net/api/newsalert?") };

        HttpResponseMessage response = null;

        var payload = new AlertInfo(AlertTime, AlertTitle, AlertAuthor, AlertDescription, AlertPriority, updateInfo);

        var payloadString = new StringContent(System.Text.Json.JsonSerializer.Serialize(payload), Encoding.UTF8, MediaTypeNames.Application.Json);

        response = await client.PostAsync(client.BaseAddress, payloadString);

        if (response.IsSuccessStatusCode)
        {
            success = true;
        }
        else
        {
            success = false;
        }
    }

}