@page "/createAccount"
@using System.Text
@using System.Net.Mime
@using System.Text.Json
@using emerge.Data

<MudText Typo="Typo.h4" Align="Align.Center">Create New Account</MudText>
<MudDivider DividerType="DividerType.Middle" Class="my-6" />

<MudContainer Class="d-flex justify-center align-center">
    <MudRadioGroup @bind-SelectedOption="Administrator">
        <MudRadio Option="false" Color="Color.Primary" UnCheckedColor="Color.Default">User</MudRadio>
        <MudRadio Option="true" Color="Color.Primary" UnCheckedColor="Color.Default">Administrator</MudRadio>
    </MudRadioGroup>
</MudContainer>

<MudContainer Class="d-flex justify-center align-center">
    <MudItem xs="12" sm="6" md="4">
        <MudTextField @bind-Value="Name" Label="Name" Variant="Variant.Outlined" Margin="Margin.Dense"></MudTextField>
        <MudSpacer />
        <MudTextField @bind-Value="Username" Label="Username" Variant="Variant.Outlined" Margin="Margin.Dense"></MudTextField>
        <MudSpacer />
        <MudTextField @bind-Value="Email" Label="Email" Variant="Variant.Outlined" Margin="Margin.Dense"></MudTextField>
        <MudSpacer />
        <MudTextField @bind-Value="Password" Label="Password" Variant="Variant.Outlined" Margin="Margin.Dense"></MudTextField>
        <MudSpacer />
        <MudTextField @bind-Value="Password" Label="Password" HelperText="Repeat the password." HelperTextOnFocus="true" Variant="Variant.Outlined" Margin="Margin.Dense"></MudTextField>
    </MudItem>
</MudContainer>


<MudContainer Class="d-flex justify-center align-center">
    <MudButton Href="/profile"
               Disabled="@_processing"
               OnClick="AddProfile"
               Variant="Variant.Text">
        @if (_processing)
        {
            <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true" />
            <MudText Class="ms-2">Processing</MudText>
        }
        else
        {
            <MudText>Register</MudText>
        }
    </MudButton>
</MudContainer>

@code {
    public string Name { get; set; }
    public string Username { get; set; }
    public string Email { get; set; }
    public string Password { get; set; }
    public bool Administrator { get; set; } = true;
    private bool _processing = false;

    private async Task AddProfile()
    {
        _processing = true;

        HttpClient client = new HttpClient { BaseAddress = new Uri("https://emergeproj.azurewebsites.net/api/profile") };

        HttpResponseMessage response = null;

        var payload = new UserProfile()
        {
            Name = Name,
            Username = Username,
            Password = Password,
            Email = Email,
            Admin = Administrator
        };

        var payloadString = new StringContent(System.Text.Json.JsonSerializer.Serialize(payload), Encoding.UTF8, MediaTypeNames.Application.Json);

        response = await client.PostAsync(client.BaseAddress, payloadString);

        _processing = false;
    }
}

